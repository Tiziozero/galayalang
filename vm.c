#include <gala.h>
#include <stdint.h>
#include <stdio.h>
#define GALA_INCLUDE
#include "vm.h"



int run(char* buf, usize len);
int main(int argc, char** argv) {
    try(argc > 1);
    FILE* f = fopen(argv[1], "rb");
    try(f != 0);

    fseek(f, 0, SEEK_END);
    usize len = ftell(f);
    fseek(f, 0, SEEK_SET);

    char* buf = malloc((len)*sizeof(char));
    try(buf != 0);
    fread(buf,1, len, f);
    fclose(f);

    Info("file of size %lu\n", len);
    for(size_t i = 0; i < len; i++) {
        printf("%.02x ", buf[i]);
    }
    try(buf[len]==0);
    println("");

    char prog_1[] = {
        make_instruction(VM_OP_MOV, VM_OP_REG_IM),
        R1, 8, // 0,
        make_instruction(VM_OP_MOV, VM_OP_REG_IM),
        R2, 7, // 0,
        make_instruction(VM_OP_ADD, VM_OP_REG_REG),
        R1 << 4 | R2,
        make_instruction(VM_OP_ADD, VM_OP_REG_REG),
        R0 << 4 | R1,
        make_instruction(VM_OP_HLT, 0),
    };
    char prog_2_1[] = { // works?
        make_instruction(VM_OP_MOV, VM_OP_REG_IM),
        R1, 8, // 0, // 1 // 2
        make_instruction(VM_OP_PUSH, 0),
        R1, // 4
        make_instruction(VM_OP_MOV, VM_OP_REG_IM),
        R1, 5, // 7
        make_instruction(VM_OP_PUSH, 0),
        R1, // 9
        // make_instruction(VM_OP_PUSH, 0), // 10
        make_instruction(VM_OP_JMP, 0), // 10
        18, 0, // 11 12 -> jump to 20
        make_instruction(VM_OP_HLT, 0), // 13
        make_instruction(VM_OP_NOP, 0), // 14
        make_instruction(VM_OP_NOP, 0), // 15
        make_instruction(VM_OP_NOP, 0), // 16
        make_instruction(VM_OP_NOP, 0), // 17
        make_instruction(VM_OP_POP, 0), R1, // 18, 19
        make_instruction(VM_OP_POP, 0), R2, // 20, 21
        make_instruction(VM_OP_ADD, VM_OP_REG_REG), R1 << 4 | R2, // 23,24,25
        make_instruction(VM_OP_ADD, VM_OP_REG_REG),
        R0 << 4 | R1,
        make_instruction(VM_OP_JMP, 0), // 12
        13,
    };
    char prog_2[] = { // fix
        make_instruction(VM_OP_MOV, VM_OP_REG_MEM),
        RPC, 11, 0, // move value 10 into PC // pc = 3 // lol RPC is the same instruction as HLT
        make_instruction(VM_OP_NOP,0), // 4
        make_instruction(VM_OP_NOP,0), // 5
        make_instruction(VM_OP_NOP,0), // 6
        make_instruction(VM_OP_NOP,0), // 7
        make_instruction(VM_OP_NOP,0), // 8
        make_instruction(VM_OP_NOP,0), // 9
        make_instruction(VM_OP_HLT,0), // 10
        0,1,0,0,0,0, // 11 12 ...
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
        1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,1<<3,
    };
    prog_2[256] = make_instruction(VM_OP_MOV, VM_OP_REG_IM);
    prog_2[257] = R0 ;
    prog_2[258] = 7 ;




    printf("%d %d %d\n", 1 << 3, 1 << 4, make_instruction(VM_OP_HLT,0));
    int i; // = run(prog_1, sizeof(prog_1)/sizeof(prog_1[0]));
    // Info("prog_1 Returned %d\n", i);
    i = run(prog_2, sizeof(prog_2)/sizeof(prog_2[0]));
    Info("prog_2 Returned %d, memory at 11 and 12=%d %d\n", i, (uint8_t)prog_2[11], (uint8_t)prog_2[12]);
    free(buf);
    return 0;
}
